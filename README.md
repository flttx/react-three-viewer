# React Three.js 3D 模型查看器

一个基于 React 和 Three.js 构建的高级 3D 模型查看器，支持多种 3D 文件格式，提供实时材质编辑和高级渲染效果。

## 🌟 主要特性

### 📁 多格式支持

- **GLTF/GLB**: 完整支持 PBR 材质和动画
- **OBJ**: 经典 3D 模型格式
- **STL**: 3D 打印常用格式
- 支持批量导入多个模型文件

### 🎨 高级材质系统

- **自定义着色器**: 基于 GLSL 的高性能渲染
- **实时材质编辑**:
  - 基础色、脊线色、谷线色调节
  - 漫反射、环境光、高光强度控制
  - 轮廓光效果和锐度调节
  - Cavity 效果（凹凸细节增强）
  - 曝光和对比度调节
- **动态光照**: 可调节主光源方位角和仰角

### 🖱️ 交互功能

- **轨道控制**: 平滑的旋转、缩放、平移操作
- **模型选择**: 点击选择场景中的模型
- **轮廓高亮**: 选中模型的视觉反馈
- **自动旋转**: 可选的模型自动旋转展示

### 🔧 高级功能

- **几何体优化**:
  - 顶点合并和法线重计算
  - Taubin 平滑算法
  - 自适应细分
- **后处理效果**: 基于 EffectComposer 的轮廓线渲染
- **场景管理**: 多模型管理和显示/隐藏控制
- **材质导出**: 支持着色器参数导出为 JSON

## 🚀 快速开始

### 环境要求

- Node.js 16+
- npm 或 yarn

### 安装依赖

```bash
npm install
# 或
yarn install
```

### 启动开发服务器

```bash
npm run dev
# 或
yarn dev
```

### 构建生产版本

```bash
npm run build
# 或
yarn build
```

## 📦 技术栈

### 核心依赖

- **React 18.3.1**: 现代化的用户界面框架
- **Three.js 0.171.0**: 强大的 3D 图形库
- **Vite 6.0.1**: 快速的构建工具

### Three.js 扩展

- `OrbitControls`: 相机轨道控制
- `GLTFLoader`: GLTF/GLB 文件加载器
- `OBJLoader`: OBJ 文件加载器
- `STLLoader`: STL 文件加载器
- `EffectComposer`: 后处理效果合成器
- `OutlinePass`: 轮廓线渲染通道

## 🎯 使用指南

### 导入模型

1. 点击"导入模型"按钮
2. 选择支持的 3D 文件格式（.glb, .gltf, .obj, .stl）
3. 支持同时选择多个文件批量导入

### 材质编辑

在右侧材质面板中可以调节：

#### 颜色设置

- **基础色**: 模型的主要颜色
- **脊线颜色**: 凸起部分的颜色
- **谷线颜色**: 凹陷部分的颜色

#### 光照与明暗

- **漫反射**: 控制表面的漫反射强度
- **环境光**: 整体亮度调节
- **高光强度**: 反射光斑的强度
- **光泽度**: 高光的锐利程度
- **轮廓光**: 边缘发光效果
- **曝光**: 整体亮度映射
- **对比度**: 明暗对比强度

#### Cavity 设置

- **Cavity 强度**: 凹凸细节的整体强度
- **脊线强度**: 凸起部分的增强程度
- **谷线强度**: 凹陷部分的增强程度

#### 主光方向

- **方位角**: 光源的水平角度 (0-360°)
- **仰角**: 光源的垂直角度 (-5-85°)

### 场景操作

- **鼠标左键拖拽**: 旋转视角
- **鼠标右键拖拽**: 平移视角
- **鼠标滚轮**: 缩放视角
- **点击模型**: 选择模型
- **清理场景**: 移除所有模型

## 🔬 技术细节

### 着色器系统

项目使用自定义的顶点和片段着色器实现高级渲染效果：

- **法线平滑**: 多级法线过滤减少噪点
- **Cavity 映射**: 基于几何体梯度的凹凸检测
- **PBR 光照**: 物理基础的光照计算
- **色调映射**: HDR 到 LDR 的曝光控制

### 几何体处理

- **顶点合并**: 优化重复顶点
- **法线重计算**: 确保正确的光照效果
- **Taubin 平滑**: 保持细节的网格平滑算法
- **自适应细分**: 根据边长自动调整细分级别

### 性能优化

- **材质复用**: 避免重复创建材质对象
- **几何体共享**: 相同几何体的实例化
- **内存管理**: 自动清理不用的资源
- **渲染优化**: 基于视锥剔除的高效渲染

## 📁 项目结构

### 核心模块

#### 材质系统

- `createSculptMaterial()`: 创建自定义着色器材质
- `applyMaterialUniforms()`: 更新材质参数
- `createBackMaterial()`: 创建背面材质

#### 几何体处理

- `smoothMeshGeometry()`: 网格平滑处理
- `subdivideGeometry()`: 几何体细分
- `taubinSmoothInPlace()`: Taubin 平滑算法

#### 场景管理

- `registerModelInScene()`: 模型注册到场景
- `prepareObjectForScene()`: 模型预处理
- `fitCameraToObject()`: 相机自适应定位

## 🎨 界面设计

- **现代化 UI**: 深色主题，毛玻璃效果
- **响应式布局**: 适配不同屏幕尺寸
- **直观操作**: 拖拽式文件导入
- **实时反馈**: 参数调节即时生效

## 🔧 自定义扩展

### 添加新的文件格式支持

在 `handleFileChange` 函数中添加新的加载器：

```javascript
// 示例：添加 FBX 支持
import { FBXLoader } from "three/examples/jsm/loaders/FBXLoader.js";

const fbxLoader = new FBXLoader();
// 在相应的 case 中处理 .fbx 文件
```

### 自定义材质参数

在 `defaultMaterialState` 中添加新参数，并在着色器中使用：

```javascript
const defaultMaterialState = {
  // 现有参数...
  customParameter: 1.0,
};
```

## 📄 许可证

本项目采用 MIT 许可证。

## 🤝 贡献

欢迎提交 Issue 和 Pull Request 来改进项目！

---

**注意**: 本项目主要用于学习和演示目的，展示了 React 与 Three.js 结合的高级 3D 渲染技术。
